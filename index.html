<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Calculate your luck in Pok√©mon TCG Pocket!"/>
  <title>Pok√©mon TCG Pocket Luck Calculator</title>
  <!-- Pok√©mon-inspired font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    /* Overall background with a subtle gradient */
    body {
      font-family: 'Trebuchet MS', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #90CAF9, #F48FB1);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background-color: #FFF9C4;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0px 6px 10px rgba(0,0,0,0.2);
      border: 3px solid #FFCA28;
      position: relative;
      z-index: 1;
    }
    /* Title styling */
    h1 {
      text-align: center;
      font-family: 'Press Start 2P', cursive;
      font-size: 2em;
      margin-bottom: 20px;
      color: #3E2723;
      text-shadow: 2px 2px 0 #FFF, 4px 4px 0 #FFEB3B;
    }
    .section {
      margin-bottom: 20px;
    }
    /* Grid layout for rarity cards */
    .rarity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .card label {
      display: block;
      font-size: 0.9em;
      margin-bottom: 5px;
      color: #424242;
    }
    .card input,
    .packs-card input {
      width: 60px;
      padding: 5px;
      font-size: 0.9em;
      border: 1px solid #FFCA28;
      border-radius: 5px;
      text-align: center;
      transition: transform 0.2s;
    }
    .card input:focus,
    .packs-card input:focus {
      border-color: #D32F2F;
      box-shadow: 0 0 5px rgba(211,47,47,0.5);
      outline: none;
      transform: scale(1.1);
    }
    /* Packs opened card */
    .packs-card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      width: 150px;
      margin: 0 auto 20px auto;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .packs-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .packs-card label {
      display: block;
      font-size: 0.9em;
      margin-bottom: 5px;
      color: #424242;
    }
    .button {
      padding: 12px 20px;
      font-size: 1.1em;
      font-weight: bold;
      background-color: #D32F2F;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      margin-top: 15px;
      transition: background-color 0.3s;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .button:hover {
      background-color: #B71C1C;
    }
    .result {
      margin-top: 10px;
      font-size: 1em;
      color: #424242;
    }
    /* Overall score styling */
    .score-highlight {
      font-size: 1.8em;
      font-weight: bold;
      padding: 15px;
      border: 3px solid #D32F2F;
      border-radius: 10px;
      text-align: center;
      background-color: #FFCDD2;
      margin-bottom: 10px;
      transition: transform 0.4s;
    }
    .section h2 {
      color: #D32F2F;
      text-shadow: 1px 1px 0 #FFF;
      margin-bottom: 10px;
    }
    /* List styling for per-rarity breakdown */
    ul {
      list-style: none;
      padding: 0;
    }
    ul li {
      background: #FFFDE7;
      margin-bottom: 10px;
      padding: 10px;
      border: 2px dashed #FFCA28;
      border-radius: 8px;
    }
    ul li em {
      color: #1976D2;
    }
    .mascot {
      text-align: center;
      font-size: 1.4em;
      margin-top: 10px;
      font-weight: bold;
      color: #3E2723;
    }
    /* Pok√©mon image section for overall luck */
    .pokemon-image {
      text-align: center;
      margin-top: 15px;
    }
    .pokemon-image img {
      width: 120px;
      height: auto;
      border: 2px solid #D32F2F;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    /* Confetti styling */
    .confetti {
      position: fixed;
      top: 0;
      width: 10px;
      height: 10px;
      opacity: 0.9;
      z-index: 9999;
      pointer-events: none;
      border-radius: 2px;
    }
    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .pulse {
      animation: pulse 1s infinite;
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
    }
    .shake {
      animation: shake 0.6s;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pok√©mon TCG Pocket Luck Calculator</h1>

    <!-- Rarity inputs (using emoji symbols) -->
    <div class="rarity-grid section">
      <div class="card">
        <label>üëë Crown Rares</label>
        <input type="number" id="crCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê‚≠ê Triple Stars</label>
        <input type="number" id="3sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê Double Stars</label>
        <input type="number" id="2sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê Single Stars</label>
        <input type="number" id="1sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚ô¶‚ô¶‚ô¶‚ô¶ Quad Diamonds</label>
        <input type="number" id="4dCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>Rare Packs</label>
        <input type="number" id="rareCards" min="0" class="luck-input" />
      </div>
    </div>

    <!-- Packs opened -->
    <div class="packs-card section">
      <label>Packs Opened</label>
      <input type="number" id="packsOpened" min="0" class="luck-input" />
    </div>

    <button class="button" id="submitButton">Submit</button>
    <div id="errorHandling" class="result"></div>

    <!-- Overall Luck Score -->
    <div class="section">
      <h2>Your Overall Luck Score:</h2>
      <div id="scoreBox" class="score-highlight"></div>
      <div id="luckRating" class="mascot"></div>
      <div id="pokemonImage" class="pokemon-image"></div>
    </div>

    <!-- Luck by Rarity -->
    <div class="section">
      <h2>Luck Score by Rarity:</h2>
      <div id="luckByRarity" class="result"></div>
    </div>

    <!-- Explanation -->
    <div class="section">
      <h2>How It Works:</h2>
      <p>
        For each rarity, we compare the <em>actual</em> number of cards pulled to the <em>expected</em> amount.
        We then display a <strong>Luck Factor</strong> in a technical format:
        <em>‚ÄúYou pulled 25% more than expected.‚Äù</em> or <em>‚ÄúYou pulled 10% fewer than expected.‚Äù</em>
        If no cards are pulled for a rarity, a unique message is shown.
      </p>
      <p>
        These individual differences are combined to produce an overall Luck Score (0‚Äì100).
        Based on your final score, one of several Pok√©mon‚Äîwith its own description‚Äîis randomly selected to represent your pull.
      </p>
      <p>
        <strong>Note on Diamond Rarities:</strong> In Pok√©mon TCG Pocket, only Quad Diamonds (‚ô¶‚ô¶‚ô¶‚ô¶) are tracked.
        Lower diamond rarities are grouped with the other star rarities.
      </p>
    </div>
  </div>

  <script>
    // Navigate inputs with Enter key
    document.addEventListener("DOMContentLoaded", function() {
      const inputs = document.querySelectorAll('.luck-input');
      inputs.forEach((input, index, arr) => {
        input.addEventListener('keydown', function(e) {
          if (e.key === "Enter") {
            e.preventDefault();
            if (index + 1 < arr.length) {
              arr[index + 1].focus();
              arr[index + 1].scrollIntoView({ behavior: "smooth", block: "center" });
            } else {
              document.getElementById('submitButton').focus();
            }
          }
        });
      });
    });

    /* Expanded Individual Rarity Descriptions ‚Äì Technical Ranges */
    const rarityDescriptionsOriginal = {
      ">=150": [
        "Exceptional performance ‚Äì you pulled 50% more than expected.",
        "Phenomenal result ‚Äì far exceeding statistical predictions.",
        "Outstanding ‚Äì your pull is extraordinary."
      ],
      ">=130": [
        "Very strong performance ‚Äì you pulled around 30% more than expected.",
        "Remarkable ‚Äì significantly above the statistical norm.",
        "Impressive ‚Äì a substantial positive deviation."
      ],
      ">=110": [
        "Slightly above average ‚Äì roughly 10% more than expected.",
        "Good ‚Äì modestly exceeding expectations.",
        "Solid ‚Äì a small but positive variance."
      ],
      ">=90": [
        "As expected ‚Äì your results match probability closely.",
        "On target ‚Äì statistically average pull.",
        "Exactly as predicted by chance."
      ],
      ">=75": [
        "Slightly below average ‚Äì about 25% fewer than expected.",
        "Underperforming ‚Äì a minor negative variance.",
        "Marginally disappointing ‚Äì below statistical expectation."
      ],
      ">=60": [
        "Below average ‚Äì approximately 40% fewer than expected.",
        "Subpar result ‚Äì noticeably underperforming.",
        "Significantly below expectation ‚Äì not a great pull."
      ],
      ">=45": [
        "Poor performance ‚Äì dramatically less than expected.",
        "Substantially underwhelming ‚Äì major deviation from norms.",
        "Considerably disappointing ‚Äì far below statistical predictions."
      ],
      ">=25": [
        "Very poor ‚Äì extremely unlikely outcome, far below expectation.",
        "Almost no luck ‚Äì a stark contrast to probability.",
        "Disastrous ‚Äì a result that defies statistical odds."
      ],
      "else": [
        "No luck at all ‚Äì a complete absence where some were expected.",
        "Utter failure ‚Äì a result well below any statistical probability.",
        "A total miss ‚Äì no positive outcomes detected."
      ]
    };

    /* Unique Zero-Pull Descriptions for each rarity */
    const zeroRarityDescriptions = {
      "üëë Crown Rare": [
        "No Crown Rares pulled ‚Äì the pinnacle remained elusive.",
        "Zero Crown Rares ‚Äì even legends have off days.",
        "No Crown Rares ‚Äì the highest tier slipped by."
      ],
      "‚≠ê‚≠ê‚≠ê Triple Star": [
        "No Triple Stars pulled ‚Äì the brilliance did not shine today.",
        "Zero Triple Stars ‚Äì a near miss in a rare category.",
        "No Triple Stars ‚Äì the odds were against you."
      ],
      "‚≠ê‚≠ê Double Star": [
        "No Double Stars pulled ‚Äì a disappointing absence.",
        "Zero Double Stars ‚Äì the numbers just didn‚Äôt add up.",
        "No Double Stars ‚Äì a gap in your collection."
      ],
      "‚≠ê Single Star": [
        "No Single Stars pulled ‚Äì even the common ones hid from you.",
        "Zero Single Stars ‚Äì a surprising void.",
        "No Single Stars ‚Äì an unexpected miss."
      ],
      "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": [
        "No Quad Diamonds pulled ‚Äì the sparkle was missing.",
        "Zero Quad Diamonds ‚Äì the gems remained uncollected.",
        "No Quad Diamonds ‚Äì luck did not shine here."
      ],
      "Rare (God Pack)": [
        "No Rare Pack cards pulled ‚Äì the jackpot eluded you.",
        "Zero Rare Pack cards ‚Äì the ultimate rarity was absent.",
        "No Rare Pack cards ‚Äì the gods were silent."
      ]
    };

    let rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));

    function pickUniqueDescription(rangeKey) {
      if (!rarityDescriptions[rangeKey] || rarityDescriptions[rangeKey].length === 0) {
        rarityDescriptions[rangeKey] = [...rarityDescriptionsOriginal[rangeKey]];
      }
      const arr = rarityDescriptions[rangeKey];
      const index = Math.floor(Math.random() * arr.length);
      return arr.splice(index, 1)[0];
    }

    function getRarityLuckDescription(score, rarityKey) {
      const luckScore = parseFloat(score);
      if (isNaN(luckScore)) return "";
      if (luckScore === 0 && zeroRarityDescriptions[rarityKey]) {
        // Use the unique zero-pull description
        const arr = zeroRarityDescriptions[rarityKey];
        const index = Math.floor(Math.random() * arr.length);
        return arr[index];
      }
      if (luckScore >= 150) return pickUniqueDescription(">=150");
      else if (luckScore >= 130) return pickUniqueDescription(">=130");
      else if (luckScore >= 110) return pickUniqueDescription(">=110");
      else if (luckScore >= 90) return pickUniqueDescription(">=90");
      else if (luckScore >= 75) return pickUniqueDescription(">=75");
      else if (luckScore >= 60) return pickUniqueDescription(">=60");
      else if (luckScore >= 45) return pickUniqueDescription(">=45");
      else if (luckScore >= 25) return pickUniqueDescription(">=25");
      else return pickUniqueDescription("else");
    }

    // Overall brackets: each with 3 Pok√©mon options (description + image)
    const overallBrackets = {
      ">=80": [
        { description: "Unstoppable ‚Äì like Mewtwo at full power!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png", alt: "Mewtwo" },
        { description: "Legendary ‚Äì like Lugia reigning supreme!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/249.png", alt: "Lugia" },
        { description: "Phenomenal ‚Äì like Rayquaza soaring the skies!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/384.png", alt: "Rayquaza" }
      ],
      ">=65": [
        { description: "Impressive ‚Äì like Charizard blazing the field!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png", alt: "Charizard" },
        { description: "Formidable ‚Äì like Tyranitar dominating the arena!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/248.png", alt: "Tyranitar" },
        { description: "Strong ‚Äì like Salamence in full flight!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/373.png", alt: "Salamence" }
      ],
      ">=50": [
        { description: "Steady ‚Äì like Onix holding the fort!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/95.png", alt: "Onix" },
        { description: "Reliable ‚Äì like Snorlax absorbing any challenge!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png", alt: "Snorlax" },
        { description: "Solid ‚Äì like Golem standing unyielding!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/76.png", alt: "Golem" }
      ],
      ">=35": [
        { description: "Moderate ‚Äì like Pikachu with a slight shortfall.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png", alt: "Pikachu" },
        { description: "Average ‚Äì like Raichu just missing the mark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/26.png", alt: "Raichu" },
        { description: "Room for improvement ‚Äì like Jolteon needing a spark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/135.png", alt: "Jolteon" }
      ],
      ">=20": [
        { description: "Underperforming ‚Äì like Rattata barely making an appearance.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/19.png", alt: "Rattata" },
        { description: "Disappointing ‚Äì like Pichu failing to spark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/172.png", alt: "Pichu" },
        { description: "Lackluster ‚Äì like Sentret lost in the crowd.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/161.png", alt: "Sentret" }
      ],
      "else": [
        { description: "Abysmal ‚Äì like Magikarp with no splash at all!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/129.png", alt: "Magikarp" },
        { description: "Pitiful ‚Äì like Zubat endlessly buzzing in the dark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/41.png", alt: "Zubat" },
        { description: "Catastrophic ‚Äì like Ditto failing to transform your fate.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/132.png", alt: "Ditto" }
      ]
    };

    function getOverallBracket(score) {
      const s = parseFloat(score);
      if (isNaN(s)) return null;
      let bracketKey = "";
      if (s >= 80) bracketKey = ">=80";
      else if (s >= 65) bracketKey = ">=65";
      else if (s >= 50) bracketKey = ">=50";
      else if (s >= 35) bracketKey = ">=35";
      else if (s >= 20) bracketKey = ">=20";
      else bracketKey = "else";
      const options = overallBrackets[bracketKey];
      return options[Math.floor(Math.random() * options.length)];
    }

    // Technical Luck Factor text
    function getLuckFactorWording(luckFactor) {
      if (luckFactor > 0) {
        return `You pulled ${luckFactor.toFixed(0)}% more than expected.`;
      } else if (luckFactor < 0) {
        return `You pulled ${Math.abs(luckFactor).toFixed(0)}% fewer than expected.`;
      } else {
        return `Exactly on the mark (as expected).`;
      }
    }

    // Confetti functions (unchanged)
    function launchConfetti() {
      const colors = ["#f44336", "#e91e63", "#9c27b0", "#2196f3", "#03a9f4", "#00bcd4", "#4caf50", "#ffeb3b", "#ffc107", "#ff5722"];
      const numConfetti = 60;
      for (let i = 0; i < numConfetti; i++) {
        const confetto = document.createElement("div");
        confetto.classList.add("confetti");
        document.body.appendChild(confetto);
        const size = Math.floor(Math.random() * 8) + 8;
        confetto.style.width = size + "px";
        confetto.style.height = size + "px";
        confetto.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetto.style.left = Math.random() * window.innerWidth + "px";
        confetto.style.top = "-20px";
        const fallDuration = Math.random() * 3 + 2;
        confetto.style.transition = `top ${fallDuration}s linear, opacity 2s ease-in`;
        const drift = (Math.random() - 0.5) * 100;
        confetto.style.transform = `translateX(${drift}px) rotate(${Math.random() * 360}deg)`;
        requestAnimationFrame(() => {
          confetto.style.top = window.innerHeight + 40 + "px";
          confetto.style.opacity = 0;
        });
        setTimeout(() => {
          if (confetto.parentNode) confetto.parentNode.removeChild(confetto);
        }, (fallDuration + 2) * 1000);
      }
    }

    function launchSadConfetti() {
      const colors = ["#555", "#444", "#333", "#222", "#666", "#777"];
      const numDrops = 40;
      for (let i = 0; i < numDrops; i++) {
        const drop = document.createElement("div");
        drop.classList.add("confetti");
        document.body.appendChild(drop);
        const size = Math.floor(Math.random() * 6) + 6;
        drop.style.width = size + "px";
        drop.style.height = size + "px";
        drop.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        drop.style.left = Math.random() * window.innerWidth + "px";
        drop.style.top = "-20px";
        const fallDuration = Math.random() * 2 + 2;
        drop.style.transition = `top ${fallDuration}s linear, opacity 2s ease-in`;
        const drift = (Math.random() - 0.5) * 80;
        drop.style.transform = `translateX(${drift}px) rotate(${Math.random() * 360}deg)`;
        requestAnimationFrame(() => {
          drop.style.top = window.innerHeight + 40 + "px";
          drop.style.opacity = 0.2;
        });
        setTimeout(() => {
          if (drop.parentNode) drop.parentNode.removeChild(drop);
        }, (fallDuration + 2) * 1000);
      }
    }

    // Calculation Logic
    function calculateAllLuck() {
      const packsOpened = parseInt(document.getElementById('packsOpened').value) || 0;
      if (packsOpened <= 0) {
        document.getElementById('errorHandling').innerHTML = 'Please enter a valid number of opened packs.';
        return;
      }

      const totalCardsPulled =
        (parseInt(document.getElementById('crCards').value) || 0) +
        (parseInt(document.getElementById('3sCards').value) || 0) +
        (parseInt(document.getElementById('2sCards').value) || 0) +
        (parseInt(document.getElementById('1sCards').value) || 0) +
        (parseInt(document.getElementById('4dCards').value) || 0) +
        (parseInt(document.getElementById('rareCards').value) || 0);

      if (totalCardsPulled > packsOpened * 5) {
        document.getElementById('errorHandling').innerHTML = 
          `Input Error: You pulled ${totalCardsPulled} cards from ${packsOpened} pack(s), but the maximum possible is ${packsOpened * 5}. Check your inputs.`;
        return;
      }
      document.getElementById('errorHandling').innerHTML = '';

      // Reset descriptions for uniqueness
      rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));
      calculateScore();
    }

    function calculateScore() {
      const pulls = {
        "üëë Crown Rare": parseInt(document.getElementById('crCards').value) || 0,
        "‚≠ê‚≠ê‚≠ê Triple Star": parseInt(document.getElementById('3sCards').value) || 0,
        "‚≠ê‚≠ê Double Star": parseInt(document.getElementById('2sCards').value) || 0,
        "‚≠ê Single Star": parseInt(document.getElementById('1sCards').value) || 0,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": parseInt(document.getElementById('4dCards').value) || 0,
        "Rare (God Pack)": parseInt(document.getElementById('rareCards').value) || 0
      };

      const pullRates = {
        "üëë Crown Rare": 0.00193,
        "‚≠ê‚≠ê‚≠ê Triple Star": 0.0112,
        "‚≠ê‚≠ê Double Star": 0.0255,
        "‚≠ê Single Star": 0.127,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": 0.0732,
        "Rare (God Pack)": 1/2000
      };

      let resultsHTML = "<ul>";
      let totalLuck = 0;
      const packsOpened = parseInt(document.getElementById('packsOpened').value);

      for (let rarity in pulls) {
        let actual = pulls[rarity];
        let expected = pullRates[rarity] * packsOpened;
        let luckDisplay = "";
        let desc = "";

        if (expected > 0) {
          if (actual === 0) {
            luckDisplay = "No pulls (below expected)";
            desc = getRarityLuckDescription(0, rarity);
            let difference = actual - expected;
            let ratio = difference / expected;
            totalLuck += ratio * 100;
          } else {
            let rawLuckScore = (actual / expected) * 100;
            let luckFactor = rawLuckScore - 100;
            luckDisplay = getLuckFactorWording(luckFactor);
            desc = getRarityLuckDescription(rawLuckScore, rarity);
            let difference = actual - expected;
            let ratio = difference / expected;
            totalLuck += ratio * 100;
          }
        } else {
          luckDisplay = "N/A";
        }

        resultsHTML += `
          <li>
            <strong>${rarity}:</strong> Actual: ${actual}, Expected: ${expected.toFixed(2)}<br>
            <strong>Luck Factor:</strong> ${luckDisplay}<br>
            <em>${desc}</em>
          </li>`;
      }
      resultsHTML += "</ul>";
      document.getElementById('luckByRarity').innerHTML = resultsHTML;

      // Normalize overall luck score to 0‚Äì100
      let normalizedScore = ((totalLuck + 600) / 1200) * 100;
      normalizedScore = Math.min(Math.max(normalizedScore, 0), 100);
      let finalScore = normalizedScore.toFixed(0);
      const scoreBox = document.getElementById('scoreBox');
      scoreBox.innerHTML = `Overall Luck Score: ${finalScore}/100`;
      scoreBox.classList.remove('pulse', 'shake');
      if (finalScore >= 80) scoreBox.classList.add('pulse');
      else if (finalScore < 35) scoreBox.classList.add('shake');

      // Use overall bracket for description & Pok√©mon
      const overall = getOverallBracket(finalScore);
      document.getElementById('luckRating').innerHTML = overall.description;
      document.getElementById('pokemonImage').innerHTML = `<img src="${overall.image}" alt="${overall.alt}" title="${overall.alt}" />`;

      // Launch confetti
      if (finalScore >= 80) launchConfetti();
      else if (finalScore < 35) launchSadConfetti();
    }

    document.getElementById('submitButton').addEventListener('click', calculateAllLuck);
  </script>
</body>
</html>
