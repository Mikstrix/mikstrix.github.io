<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Calculate your luck in Pok√©mon TCG Pocket!"/>
  <title>Pok√©mon TCG Pocket Luck Calculator</title>
  <!-- Using Press Start 2P for a retro, Pok√©mon-inspired vibe -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    /* Background decal: subtle repeating Pok√©ball pattern */
    .bg-decal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://upload.wikimedia.org/wikipedia/commons/5/53/Pokeball.png') repeat;
      opacity: 0.05;
      z-index: -1;
    }
    /* Overall styling with a Pok√©mon TCG vibe */
    body {
      font-family: 'Press Start 2P', cursive;
      font-size: 14px;
      margin: 0;
      background: linear-gradient(135deg, #90CAF9, #F48FB1);
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
      position: relative;
    }
    /* Floating Pok√©mon decorations with continuous movement */
    @keyframes floatAround {
      0% { transform: translate(0, 0); }
      25% { transform: translate(30px, -20px); }
      50% { transform: translate(-20px, 30px); }
      75% { transform: translate(10px, -10px); }
      100% { transform: translate(0, 0); }
    }
    .floating-pokemon {
      position: fixed;
      z-index: 0; /* in the background */
      animation: floatAround 20s ease-in-out infinite;
    }
    .floating-pokemon.top-left { top: 10px; left: 10px; width: 60px; }
    .floating-pokemon.top-right { top: 10px; right: 10px; width: 60px; }
    .floating-pokemon.bottom-right { bottom: 10px; right: 10px; width: 60px; }
    .floating-pokemon.bottom-left { bottom: 10px; left: 10px; width: 60px; }
    .floating-pokemon img { width: 100%; height: auto; }
    /* Container with a placeholder Pok√©mon card texture background */
    .container {
      width: 100%;
      max-width: 600px;
      background-color: #FFF9C4;
      padding: 20px;
      border-radius: 15px;
      border: 3px solid #FFCA28;
      box-shadow: 0 6px 10px rgba(0,0,0,0.2);
      position: relative;
      background-image: url('https://via.placeholder.com/600x400?text=Pok%C3%A9mon+Card+Texture');
      background-size: cover;
      background-position: center;
      z-index: 1;
    }
    /* Header image using a placeholder image that reliably displays text */
    .header-image {
      text-align: center;
      margin-bottom: 10px;
    }
    .header-image img {
      width: 200px;
      height: auto;
    }
    h1 {
      text-align: center;
      font-size: 1.5em;
      margin-bottom: 20px;
      color: #3E2723;
      text-shadow: 2px 2px 0 #FFF, 4px 4px 0 #FFEB3B;
    }
    .section { margin-bottom: 20px; }
    /* Rarity cards grid with sequential fadeInUp animation */
    .rarity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .rarity-grid .card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
    }
    .rarity-grid .card:nth-child(1) { animation-delay: 0.2s; }
    .rarity-grid .card:nth-child(2) { animation-delay: 0.4s; }
    .rarity-grid .card:nth-child(3) { animation-delay: 0.6s; }
    .rarity-grid .card:nth-child(4) { animation-delay: 0.8s; }
    .rarity-grid .card:nth-child(5) { animation-delay: 1s; }
    .rarity-grid .card:nth-child(6) { animation-delay: 1.2s; }
    .card label {
      font-size: 1em;
      display: block;
      margin-bottom: 5px;
      color: #424242;
    }
    .card input,
    .packs-card input {
      width: 60px;
      padding: 5px;
      font-size: 1.1em;
      border: 1px solid #FFCA28;
      border-radius: 5px;
      text-align: center;
      transition: transform 0.2s;
    }
    .card input:focus,
    .packs-card input:focus {
      border-color: #D32F2F;
      box-shadow: 0 0 5px rgba(211,47,47,0.5);
      outline: none;
      transform: scale(1.1);
    }
    .packs-card {
      background: #FFEBCD;
      border: 2px solid #FFCA28;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      width: 150px;
      margin: 0 auto 20px auto;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .packs-card:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .packs-card label {
      font-size: 0.8em;
      display: block;
      margin-bottom: 5px;
      color: #424242;
    }
    .button {
      padding: 12px 20px;
      font-size: 0.9em;
      font-weight: bold;
      background-color: #D32F2F;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 8px;
      margin-top: 15px;
      transition: background-color 0.3s;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .button:hover { background-color: #B71C1C; }
    .result { margin-top: 10px; font-size: 0.8em; color: #424242; }
    .score-highlight {
      font-size: 1.4em;
      font-weight: bold;
      padding: 15px;
      border: 3px solid #D32F2F;
      border-radius: 10px;
      text-align: center;
      background-color: #FFCDD2;
      margin-bottom: 10px;
      transition: transform 0.4s;
    }
    .section h2 {
      font-size: 1.2em;
      color: #D32F2F;
      text-shadow: 1px 1px 0 #FFF;
      margin-bottom: 10px;
    }
    ul { list-style: none; padding: 0; }
    /* Formatting for Luck Score by Rarity results ‚Äì slower animation */
    @keyframes fadeInUpSlow {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #luckByRarity li {
      background: #FFFDE7;
      margin-bottom: 10px;
      padding: 10px;
      border: 2px dashed #FFCA28;
      border-radius: 8px;
      font-size: 0.8em;
      opacity: 0;
      animation: fadeInUpSlow 0.8s ease forwards;
    }
    /* Increase delays for slower reveal */
    #luckByRarity li:nth-child(1) { animation-delay: 1s; }
    #luckByRarity li:nth-child(2) { animation-delay: 2s; }
    #luckByRarity li:nth-child(3) { animation-delay: 3s; }
    #luckByRarity li:nth-child(4) { animation-delay: 4s; }
    #luckByRarity li:nth-child(5) { animation-delay: 5s; }
    #luckByRarity li:nth-child(6) { animation-delay: 6s; }
    /* Styled span for score numbers in red */
    .score-number {
      font-weight: bold;
      color: red;
      margin: 0 3px;
    }
    .mascot {
      text-align: center;
      font-size: 1.2em;
      margin-top: 10px;
      font-weight: bold;
      color: #3E2723;
    }
    .pokemon-image {
      text-align: center;
      margin-top: 15px;
    }
    .pokemon-image img {
      width: 100px;
      height: auto;
      border: 2px solid #D32F2F;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .confetti {
      position: fixed;
      top: 0;
      width: 10px;
      height: 10px;
      opacity: 0.9;
      z-index: 9999;
      pointer-events: none;
      border-radius: 2px;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .pulse { animation: pulse 1s infinite; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20% { transform: translateX(-5px); }
      40% { transform: translateX(5px); }
      60% { transform: translateX(-5px); }
      80% { transform: translateX(5px); }
    }
    .shake { animation: shake 0.6s; }
    /* Hide the results section initially */
    #resultsSection { display: none; }
    /* Collapsible How It Works (starts collapsed) */
    details {
      font-size: 0.8em;
      color: #3E2723;
      background: #FFFDE7;
      border: 2px dashed #FFCA28;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
    details summary { cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>
  <!-- Background decal -->
  <div class="bg-decal"></div>
  <!-- Floating Pok√©mon decorations -->
  <div class="floating-pokemon top-left">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Pikachu">
  </div>
  <div class="floating-pokemon top-right">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png" alt="Charmander">
  </div>
  <div class="floating-pokemon bottom-right">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png" alt="Mewtwo">
  </div>
  <div class="floating-pokemon bottom-left">
    <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png" alt="Bulbasaur">
  </div>

  <div class="container">
    <!-- Header image using a placeholder from via.placeholder.com -->
    <div class="header-image">
      <img src="https://via.placeholder.com/200x80?text=Pokemon+TCG" alt="Pokemon TCG Logo">
    </div>
    <h1>Pok√©mon TCG Pocket Luck Calculator</h1>

    <!-- Rarity Inputs (using emoji labels) -->
    <div class="rarity-grid section">
      <div class="card">
        <label>üëë Crown Rares</label>
        <input type="number" id="crCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê‚≠ê Triple Stars</label>
        <input type="number" id="3sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê‚≠ê Double Stars</label>
        <input type="number" id="2sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚≠ê Single Stars</label>
        <input type="number" id="1sCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>‚ô¶‚ô¶‚ô¶‚ô¶ Quad Diamonds</label>
        <input type="number" id="4dCards" min="0" class="luck-input" />
      </div>
      <div class="card">
        <label>Rare Packs</label>
        <input type="number" id="rareCards" min="0" class="luck-input" />
      </div>
    </div>

    <!-- Packs Opened -->
    <div class="packs-card section">
      <label>Packs Opened</label>
      <input type="number" id="packsOpened" min="0" class="luck-input" />
    </div>

    <button class="button" id="submitButton">Submit</button>
    <div id="errorHandling" class="result"></div>

    <!-- Results Section (hidden until Submit is pressed) -->
    <div id="resultsSection">
      <!-- Overall Luck Score Section -->
      <div class="section">
        <h2>Your Overall Luck Score:</h2>
        <div id="scoreBox" class="score-highlight"></div>
        <div id="luckRating" class="mascot"></div>
        <div id="pokemonImage" class="pokemon-image"></div>
      </div>
      <!-- Luck by Rarity Section -->
      <div class="section">
        <h2>Luck Score by Rarity:</h2>
        <div id="luckByRarity" class="result"></div>
      </div>
    </div>

    <!-- Collapsible How It Works Section (starts collapsed) -->
    <details>
      <summary>How It Works</summary>
      <p>
        The calculator determines your luck by comparing the actual number of cards pulled for each rarity against the expected values (derived from in‚Äêgame pull rates). For each rarity, the Luck Factor is calculated as:
      </p>
      <ul>
        <li><strong>Luck Factor (%) = (Actual √∑ Expected) √ó 100 - 100</strong></li>
      </ul>
      <p>
        A 0% Luck Factor means you pulled exactly as expected. Positive values indicate extra pulls, while negative values indicate fewer pulls. Each rarity displays a Pok√©mon‚Äëinspired message ‚Äì and if you pull zero cards in a tier, a unique message is shown.
      </p>
      <p>
        <strong>Note on Diamonds:</strong> Cards below Quad Diamonds are not tracked individually; they are assumed to be pulled at an average (100%) rate for every player.
      </p>
    </details>
  </div>

  <script>
    // LocalStorage IDs for saving inputs
    const inputIds = ['crCards', '3sCards', '2sCards', '1sCards', '4dCards', 'rareCards', 'packsOpened'];

    // Load saved inputs on DOMContentLoaded
    document.addEventListener("DOMContentLoaded", function() {
      inputIds.forEach(id => {
        const savedValue = localStorage.getItem(id);
        if (savedValue !== null) {
          document.getElementById(id).value = savedValue;
        }
      });
      // Enable navigation with the Enter key
      const inputs = document.querySelectorAll('.luck-input');
      inputs.forEach((input, index, arr) => {
        input.addEventListener('keydown', function(e) {
          if (e.key === "Enter") {
            e.preventDefault();
            if (index + 1 < arr.length) {
              arr[index + 1].focus();
              arr[index + 1].scrollIntoView({ behavior: "smooth", block: "center" });
            } else {
              document.getElementById('submitButton').focus();
            }
          }
        });
      });
    });

    // Save inputs to localStorage
    function saveInputs() {
      inputIds.forEach(id => {
        const value = document.getElementById(id).value;
        localStorage.setItem(id, value);
      });
    }

    /* Expanded Individual Rarity Descriptions in Pok√©mon Style */
    const rarityDescriptionsOriginal = {
      ">=150": [
        "Legendary pull! Like snagging a shiny Mewtwo ‚Äì a 50% bonus over the norm.",
        "Mythic result ‚Äì as if you caught Arceus on a once-in-a-lifetime day.",
        "Inconceivable ‚Äì your pull redefines rarity, a feat worthy of legends."
      ],
      ">=130": [
        "Excellent pull ‚Äì roughly 30% above expectation, like landing a secret Mega Evolution.",
        "Stellar performance ‚Äì reminiscent of a rare Charizard moment.",
        "Very strong ‚Äì your pull exceeds odds, a standout achievement."
      ],
      ">=110": [
        "Above average ‚Äì about 10% extra; a solid pull like an Eevee evolving at the right time.",
        "Good pull ‚Äì slightly exceeding expectations, like a Jolteon striking fast.",
        "Positive variance ‚Äì a modest boost over the norm."
      ],
      ">=90": [
        "Average ‚Äì your pull matches expected odds, as steady as a Bulbasaur.",
        "On target ‚Äì results align perfectly with probability.",
        "Standard ‚Äì a typical pull that meets statistical predictions."
      ],
      ">=75": [
        "Slightly under ‚Äì around 25% fewer than expected; like a Caterpie yet to evolve.",
        "Underperforming ‚Äì a modest deficit, as if a Weedle couldn‚Äôt reach its potential.",
        "Mildly disappointing ‚Äì just a bit below the expected yield."
      ],
      ">=60": [
        "Below average ‚Äì about 40% fewer; a pull as unremarkable as a Magikarp‚Äôs splash.",
        "Subpar ‚Äì noticeably under the odds, like a Pidgey lost in the wind.",
        "Poor result ‚Äì clearly below statistical expectations."
      ],
      ">=45": [
        "Very poor ‚Äì dramatically fewer than expected; a result as dismal as a Slowpoke in a sprint.",
        "Disastrous ‚Äì far below what chance predicts, like a Koffing running out of gas.",
        "Critically low ‚Äì a severe miss against the odds."
      ],
      ">=25": [
        "Extremely low ‚Äì nearly catastrophic; as if a Spearow was overshadowed by giants.",
        "Abysmal ‚Äì a pull that defies probability, like a Magmar‚Äôs flame sputtering.",
        "Utter failure ‚Äì an outcome that leaves nothing to chance."
      ],
      "else": [
        "No luck at all ‚Äì a complete absence, where even Magikarp only splashes.",
        "Absolute bust ‚Äì an outcome missing every expectation.",
        "Total failure ‚Äì no positive pulls detected."
      ]
    };

    /* Unique Zero-Pull Descriptions for each rarity */
    const zeroRarityDescriptions = {
      "üëë Crown Rare": [
        "No Crown Rares ‚Äì even legends have off days.",
        "Zero Crown Rares ‚Äì the pinnacle remained elusive.",
        "No Crown Rares ‚Äì the highest tier slipped by."
      ],
      "‚≠ê‚≠ê‚≠ê Triple Star": [
        "No Triple Stars ‚Äì the brilliance did not shine today.",
        "Zero Triple Stars ‚Äì a rare miss in this luminous category.",
        "No Triple Stars ‚Äì the spark of rarity was missing."
      ],
      "‚≠ê‚≠ê Double Star": [
        "No Double Stars ‚Äì a disappointing void in this key tier.",
        "Zero Double Stars ‚Äì the usual shine was absent.",
        "No Double Stars ‚Äì a gap in your collection."
      ],
      "‚≠ê Single Star": [
        "No Single Stars ‚Äì even the common ones hid away.",
        "Zero Single Stars ‚Äì a surprising void at the base level.",
        "No Single Stars ‚Äì an unexpected miss in everyday pulls."
      ],
      "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": [
        "No Quad Diamonds ‚Äì the gems failed to sparkle.",
        "Zero Quad Diamonds ‚Äì the rare jewels were nowhere to be found.",
        "No Quad Diamonds ‚Äì the shine of perfection was absent."
      ],
      "Rare (God Pack)": [
        "No Rare Pack cards ‚Äì the ultimate rarity was completely missed.",
        "Zero Rare Pack cards ‚Äì the jackpot remained locked.",
        "No Rare Pack cards ‚Äì the gods of rarity were silent."
      ]
    };

    let rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));

    function pickUniqueDescription(rangeKey) {
      if (!rarityDescriptions[rangeKey] || rarityDescriptions[rangeKey].length === 0) {
        rarityDescriptions[rangeKey] = [...rarityDescriptionsOriginal[rangeKey]];
      }
      const arr = rarityDescriptions[rangeKey];
      const index = Math.floor(Math.random() * arr.length);
      return arr.splice(index, 1)[0];
    }

    function getRarityLuckDescription(score, rarityKey) {
      const luckScore = parseFloat(score);
      if (isNaN(luckScore)) return "";
      if (luckScore === 0 && zeroRarityDescriptions[rarityKey]) {
        const arr = zeroRarityDescriptions[rarityKey];
        const index = Math.floor(Math.random() * arr.length);
        return arr[index];
      }
      if (luckScore >= 150) return pickUniqueDescription(">=150");
      else if (luckScore >= 130) return pickUniqueDescription(">=130");
      else if (luckScore >= 110) return pickUniqueDescription(">=110");
      else if (luckScore >= 90) return pickUniqueDescription(">=90");
      else if (luckScore >= 75) return pickUniqueDescription(">=75");
      else if (luckScore >= 60) return pickUniqueDescription(">=60");
      else if (luckScore >= 45) return pickUniqueDescription(">=45");
      else if (luckScore >= 25) return pickUniqueDescription(">=25");
      else return pickUniqueDescription("else");
    }

    /* Overall Luck Brackets ‚Äì 6 Brackets with 3 Pok√©mon options each */
    const overallBrackets = {
      ">=80": [
        { description: "Unstoppable ‚Äì like Mewtwo at full power!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png", alt: "Mewtwo" },
        { description: "Legendary ‚Äì as if you summoned Lugia on your best day!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/249.png", alt: "Lugia" },
        { description: "Mythical ‚Äì akin to witnessing Rayquaza rule the skies!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/384.png", alt: "Rayquaza" }
      ],
      ">=65": [
        { description: "Impressive ‚Äì like Charizard blazing a trail in battle!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png", alt: "Charizard" },
        { description: "Formidable ‚Äì as if Tyranitar dominated the arena!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/248.png", alt: "Tyranitar" },
        { description: "Powerful ‚Äì like Salamence soaring in a storm!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/373.png", alt: "Salamence" }
      ],
      ">=50": [
        { description: "Steady ‚Äì like Onix holding strong as a fortress.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/95.png", alt: "Onix" },
        { description: "Reliable ‚Äì like Snorlax, a titan of persistence.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png", alt: "Snorlax" },
        { description: "Solid ‚Äì like Golem, unyielding against all odds.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/76.png", alt: "Golem" }
      ],
      ">=35": [
        { description: "Moderate ‚Äì like Pikachu with a slight spark missing.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png", alt: "Pikachu" },
        { description: "Average ‚Äì like Raichu just short of a full charge.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/26.png", alt: "Raichu" },
        { description: "Room for improvement ‚Äì like Jolteon needing an extra jolt.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/135.png", alt: "Jolteon" }
      ],
      ">=20": [
        { description: "Underperforming ‚Äì like Rattata barely scurrying by.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/19.png", alt: "Rattata" },
        { description: "Disappointing ‚Äì like Pichu that just can‚Äôt spark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/172.png", alt: "Pichu" },
        { description: "Lackluster ‚Äì like Sentret lost in the tall grass.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/161.png", alt: "Sentret" }
      ],
      "else": [
        { description: "Abysmal ‚Äì like Magikarp with no splash at all!", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/129.png", alt: "Magikarp" },
        { description: "Pitiful ‚Äì like Zubat endlessly buzzing in the dark.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/41.png", alt: "Zubat" },
        { description: "Catastrophic ‚Äì like Ditto failing to transform your fate.", image: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/132.png", alt: "Ditto" }
      ]
    };

    function getOverallBracket(score) {
      const s = parseFloat(score);
      if (isNaN(s)) return null;
      let bracketKey = "";
      if (s >= 80) bracketKey = ">=80";
      else if (s >= 65) bracketKey = ">=65";
      else if (s >= 50) bracketKey = ">=50";
      else if (s >= 35) bracketKey = ">=35";
      else if (s >= 20) bracketKey = ">=20";
      else bracketKey = "else";
      const options = overallBrackets[bracketKey];
      return options[Math.floor(Math.random() * options.length)];
    }

    // Technical Luck Factor text with styled numbers
    function getLuckFactorWording(luckFactor) {
      if (luckFactor > 0) {
        return `You pulled <span class="score-number">${luckFactor.toFixed(0)}%</span> more than expected.`;
      } else if (luckFactor < 0) {
        return `You pulled <span class="score-number">${Math.abs(luckFactor).toFixed(0)}%</span> fewer than expected.`;
      } else {
        return `Exactly on the mark (as expected).`;
      }
    }

    // Spawn a floating Pok√©mon sprite for a given rarity (background; moves continuously)
    function spawnRaritySprite(rarity) {
      if (!raritySprites[rarity]) return;
      const img = document.createElement("img");
      img.src = raritySprites[rarity];
      img.alt = rarity;
      img.style.position = "fixed";
      img.style.width = "50px";
      img.style.zIndex = "0";
      img.style.opacity = 0;
      img.style.transition = "opacity 1s ease, transform 1s ease";
      // Random initial position (with padding)
      const padding = 50;
      const left = Math.random() * (window.innerWidth - padding * 2) + padding;
      const top = Math.random() * (window.innerHeight - padding * 2) + padding;
      img.style.left = left + "px";
      img.style.top = top + "px";
      document.body.appendChild(img);
      // Animate in: fade in and scale up
      setTimeout(() => {
        img.style.opacity = 1;
        img.style.transform = "scale(1.2) rotate(15deg)";
      }, 100);
      // Then continuously move (via CSS animation) by adding a class
      img.classList.add("floating-animation");
      // After 6 seconds, remove the image
      setTimeout(() => {
        img.style.opacity = 0;
        img.style.transform = "scale(0.5) rotate(-15deg)";
        setTimeout(() => {
          if (img.parentNode) img.parentNode.removeChild(img);
        }, 1000);
      }, 6000);
    }

    // Mapping rarities to a Pok√©mon sprite for floating decoration
    const raritySprites = {
      "üëë Crown Rare": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/150.png",      // Mewtwo
      "‚≠ê‚≠ê‚≠ê Triple Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png",         // Charizard
      "‚≠ê‚≠ê Double Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png",         // Pikachu
      "‚≠ê Single Star": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/1.png",           // Bulbasaur
      "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/249.png", // Lugia
      "Rare (God Pack)": "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/384.png"         // Rayquaza
    };

    // Calculation Logic
    function calculateAllLuck() {
      const packsOpened = parseInt(document.getElementById('packsOpened').value) || 0;
      if (packsOpened <= 0) {
        document.getElementById('errorHandling').innerHTML = 'Please enter a valid number of opened packs.';
        return;
      }
      const totalCardsPulled =
        (parseInt(document.getElementById('crCards').value) || 0) +
        (parseInt(document.getElementById('3sCards').value) || 0) +
        (parseInt(document.getElementById('2sCards').value) || 0) +
        (parseInt(document.getElementById('1sCards').value) || 0) +
        (parseInt(document.getElementById('4dCards').value) || 0) +
        (parseInt(document.getElementById('rareCards').value) || 0);
      if (totalCardsPulled > packsOpened * 5) {
        document.getElementById('errorHandling').innerHTML =
          `Input Error: You pulled ${totalCardsPulled} cards from ${packsOpened} pack(s), but the maximum possible is ${packsOpened * 5}. Check your inputs.`;
        return;
      }
      document.getElementById('errorHandling').innerHTML = '';
      // Reset the rarity descriptions for unique messages
      rarityDescriptions = JSON.parse(JSON.stringify(rarityDescriptionsOriginal));
      calculateScore();
      saveInputs();
    }

    function calculateScore() {
      const pulls = {
        "üëë Crown Rare": parseInt(document.getElementById('crCards').value) || 0,
        "‚≠ê‚≠ê‚≠ê Triple Star": parseInt(document.getElementById('3sCards').value) || 0,
        "‚≠ê‚≠ê Double Star": parseInt(document.getElementById('2sCards').value) || 0,
        "‚≠ê Single Star": parseInt(document.getElementById('1sCards').value) || 0,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": parseInt(document.getElementById('4dCards').value) || 0,
        "Rare (God Pack)": parseInt(document.getElementById('rareCards').value) || 0
      };

      const pullRates = {
        "üëë Crown Rare": 0.00193,
        "‚≠ê‚≠ê‚≠ê Triple Star": 0.0112,
        "‚≠ê‚≠ê Double Star": 0.0255,
        "‚≠ê Single Star": 0.127,
        "‚ô¶‚ô¶‚ô¶‚ô¶ Quadruple Diamond": 0.0732,
        "Rare (God Pack)": 1/2000
      };

      let resultsHTML = "<ul>";
      let totalLuck = 0;
      const packsOpened = parseInt(document.getElementById('packsOpened').value);
      // To ensure only one floating sprite per rarity:
      const spawnedRarities = {};

      for (let rarity in pulls) {
        let actual = pulls[rarity];
        let expected = pullRates[rarity] * packsOpened;
        let luckDisplay = "";
        let desc = "";

        if (expected > 0) {
          if (actual === 0) {
            luckDisplay = "No pulls (below expected)";
            desc = getRarityLuckDescription(0, rarity);
            let difference = actual - expected;
            let ratio = difference / expected;
            totalLuck += ratio * 100;
          } else {
            let rawLuckScore = (actual / expected) * 100;
            let luckFactor = rawLuckScore - 100;
            luckDisplay = getLuckFactorWording(luckFactor);
            desc = getRarityLuckDescription(rawLuckScore, rarity);
            let difference = actual - expected;
            let ratio = difference / expected;
            totalLuck += ratio * 100;
            // Spawn a floating sprite if not already spawned for this rarity
            if (!spawnedRarities[rarity]) {
              spawnRaritySprite(rarity);
              spawnedRarities[rarity] = true;
            }
          }
        } else {
          luckDisplay = "N/A";
        }
        resultsHTML += `
          <li>
            <strong>${rarity}:</strong> Actual: <span class="score-number">${actual}</span>, Expected: <span class="score-number">${expected.toFixed(1)}</span><br>
            <strong>Luck Factor:</strong> ${luckDisplay}<br>
            <em>${desc}</em>
          </li>`;
      }
      resultsHTML += "</ul>";
      document.getElementById('luckByRarity').innerHTML = resultsHTML;

      // Normalize overall luck to a score between 0 and 100
      let normalizedScore = ((totalLuck + 600) / 1200) * 100;
      normalizedScore = Math.min(Math.max(normalizedScore, 0), 100);
      let finalScore = normalizedScore.toFixed(0);
      const scoreBox = document.getElementById('scoreBox');
      scoreBox.innerHTML = `Overall Luck Score: <span class="score-number">${finalScore}</span>/100`;
      scoreBox.classList.remove('pulse', 'shake');
      if (finalScore >= 80) scoreBox.classList.add('pulse');
      else if (finalScore < 35) scoreBox.classList.add('shake');

      // Overall result using overall bracket
      const overall = getOverallBracket(finalScore);
      document.getElementById('luckRating').innerHTML = overall.description;
      document.getElementById('pokemonImage').innerHTML = `<img src="${overall.image}" alt="${overall.alt}" title="${overall.alt}" />`;

      // Reveal the results section
      document.getElementById('resultsSection').style.display = "block";

      if (finalScore >= 80) { launchConfetti(); }
      else if (finalScore < 35) { launchSadConfetti(); }
    }

    document.getElementById('submitButton').addEventListener('click', calculateAllLuck);
  </script>
</body>
</html>
